<?xml version="1.0"?>
<robot name="gesture_arm_hand" xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- Properties -->
  <xacro:property name="link_radius" value="0.04"/>
  <xacro:property name="link_length" value="0.5"/>
  <xacro:property name="joint_effort" value="10"/>
  <xacro:property name="joint_velocity" value="5"/>
  <xacro:property name="finger_length" value="0.1"/>
  <xacro:property name="finger_radius" value="0.01"/>
  <xacro:property name="finger_damping" value="0.5"/>

  <material name="black"><color rgba="0 0 0 1"/></material>

  <!-- Arm link -->
  <xacro:macro name="arm_link" params="name color">
    <link name="${name}">
      <inertial>
        <mass value="0.5"/>
        <origin xyz="0 0 ${link_length/2}" rpy="0 0 0"/>
        <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
      </inertial>
      <visual>
        <geometry><cylinder length="${link_length}" radius="${link_radius}"/></geometry>
        <origin xyz="0 0 ${link_length/2}" rpy="0 0 0"/>
        <material name="${color}"/>
      </visual>
      <collision>
        <geometry><cylinder length="${link_length}" radius="${link_radius}"/></geometry>
        <origin xyz="0 0 ${link_length/2}" rpy="0 0 0"/>
      </collision>
    </link>
  </xacro:macro>

  <!-- Base -->
  <link name="base_link">
    <inertial>
      <mass value="15.0"/>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>
      <inertia ixx="1" ixy="0.0" ixz="0.0" iyy="1" iyz="0.0" izz="1"/>
    </inertial>
    <visual>
      <geometry><box size="1.0 1.0 0.3"/></geometry>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>
      <material name="black"/>
    </visual>
    <collision>
      <geometry><box size="1.0 1.0 0.3"/></geometry>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>
    </collision>
  </link>

  <xacro:arm_link name="link_1" color="blue"/>
  <xacro:arm_link name="link_2" color="red"/>

  <!-- Arm joints -->
  <joint name="joint1" type="revolute">
    <parent link="base_link"/>
    <child link="link_1"/>
    <origin xyz="0 0 0.3" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.57" upper="1.57" effort="${joint_effort}" velocity="${joint_velocity}"/>
  </joint>

  <joint name="joint2" type="revolute">
    <parent link="link_1"/>
    <child link="link_2"/>
    <origin xyz="0 0 ${link_length}" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
    <limit lower="-1.57" upper="1.57" effort="${joint_effort}" velocity="${joint_velocity}"/>
  </joint>

  <!-- Palm -->
  <link name="palm_link">
  <inertial>
    <mass value="0.5"/>
    <origin xyz="0 0 0.025" rpy="0 0 0"/>
    <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
  </inertial>
  <visual>
    <geometry><box size="0.12 0.02 0.05"/></geometry>
    <origin xyz="0 0 0.025" rpy="0 0 0"/>
    <material name="gray"><color rgba="0.6 0.6 0.6 1"/></material>
  </visual>
  <collision>
    <geometry><box size="0.12 0.02 0.05"/></geometry>
    <origin xyz="0 0 0.025" rpy="0 0 0"/>
  </collision>
</link>

<joint name="wrist_joint" type="revolute">
  <parent link="link_2"/>
  <child link="palm_link"/>
  <origin xyz="0 0 ${link_length}" rpy="0 0 0"/>
  <axis xyz="1 0 0"/>
  <limit lower="-1.57" upper="1.57" effort="${joint_effort}" velocity="${joint_velocity}"/>
</joint>

  <!-- Finger -->
  <xacro:macro name="finger" params="index x y">
    <link name="finger${index}_link1">
      <inertial>
        <mass value="0.05"/>
        <origin xyz="0 0 ${finger_length/2}" rpy="0 0 0"/>
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>
      </inertial>
      <visual>
        <geometry><cylinder length="${finger_length}" radius="${finger_radius}"/></geometry>
        <origin xyz="0 0 ${finger_length/2}" rpy="0 0 0"/>
        <material name="blue"/>
      </visual>
      <collision>
        <geometry><cylinder length="${finger_length}" radius="${finger_radius}"/></geometry>
        <origin xyz="0 0 ${finger_length/2}" rpy="0 0 0"/>
      </collision>
    </link>

    <joint name="finger${index}_joint1" type="revolute">
      <parent link="palm_link"/>
      <child link="finger${index}_link1"/>
      <origin xyz="${x} ${y} 0.02" rpy="0 0 0"/>
      <axis xyz="1 0 0"/>
      <limit lower="0" upper="1.57" effort="${joint_effort}" velocity="${joint_velocity}"/>
    </joint>

    <link name="finger${index}_link2">
      <inertial>
        <mass value="0.05"/>
        <origin xyz="0 0 ${finger_length/2}" rpy="0 0 0"/>
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>
      </inertial>
      <visual>
        <geometry><cylinder length="${finger_length}" radius="${finger_radius}"/></geometry>
        <origin xyz="0 0 ${finger_length/2}" rpy="0 0 0"/>
        <material name="red"/>
      </visual>
      <collision>
        <geometry><cylinder length="${finger_length}" radius="${finger_radius}"/></geometry>
        <origin xyz="0 0 ${finger_length/2}" rpy="0 0 0"/>
      </collision>
    </link>

    <joint name="finger${index}_joint2" type="revolute">
      <parent link="finger${index}_link1"/>
      <child link="finger${index}_link2"/>
      <origin xyz="0 0 ${finger_length}" rpy="0 0 0"/>
      <axis xyz="1 0 0"/>
      <limit lower="0" upper="1.57" effort="${joint_effort}" velocity="${joint_velocity}"/>
    </joint>
  </xacro:macro>

  <xacro:finger index="1" x="-0.04" y="0"/>
  <xacro:finger index="2" x="0.00" y="0"/>
  <xacro:finger index="3" x="0.04" y="0"/>

  <!-- Transmissions -->
  <xacro:macro name="transmission" params="jname">
    <transmission name="${jname}_trans">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${jname}">
        <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
      </joint>
      <actuator name="${jname}_motor">
        <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro>

  <xacro:transmission jname="joint1"/>
  <xacro:transmission jname="joint2"/>
  <xacro:transmission jname="wrist_joint"/>
  <xacro:transmission jname="finger1_joint1"/>
  <xacro:transmission jname="finger1_joint2"/>
  <xacro:transmission jname="finger2_joint1"/>
  <xacro:transmission jname="finger2_joint2"/>
  <xacro:transmission jname="finger3_joint1"/>
  <xacro:transmission jname="finger3_joint2"/>

  <!-- Gazebo control plugin -->
  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so"/>
  </gazebo>

</robot>
